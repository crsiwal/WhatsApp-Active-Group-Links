$(document).ready(function(){Application=function(){this.pool=[],this.session=[],this.loading=!1},$.extend(Application.prototype,{init:function(){this.toastobj=siiimpleToast,this.toastobj=this.toastobj.setOptions({container:"body",class:"siiimpleToast",position:"bottom|right",margin:15,delay:0,duration:5e3,style:{}})},base_url:function(t){return window.location.protocol+"//"+window.location.hostname+"/"+this.safeVar(t,"")},toast:function(t,e){switch(e){case"success":this.toastobj.success(t);break;case"error":this.toastobj.alert(t);break;default:this.toastobj.message(t)}},getSelected:function(t,e){return!0===e?this.gethtml(`${t} option:selected`):this.get(`${t} option:selected`)},get:function(t){return this.safeVar($(`#${t}`).val(),"")},set:function(t,e){$(`#${t}`).val(e)},gethtml:function(t){return!0===this.idExist(t)?$(`#${t}`).html():""},sethtml:function(t,e,a){!0===this.idExist(t)&&(!0===a?$(`#${t}`).append(e):$(`#${t}`).html(e))},get_attr:function(t,e){return $(`#${t}`).attr(e)},set_attr:function(t,e,a){$(`#${t}`).attr(e,a)},set_session:function(t,e){this.session[t]=e},get_session:function(t){return this.isset(this.session,t)?this.session[t]:null},remove_session:function(t){return!!this.isset(this.session,t)&&delete this.session[t]},update_session:function(t,e){return!!this.isset(this.session,t)&&(this.session[t]=e,!0)},addClass:function(t,e,a){a=!1!==a,!0===this.idExist(t)&&(!0===a?$(`#${t}`).addClass(e):$(`#${t}`).removeClass(e))},show:function(t,e){e=this.safeVar(e,!1),$(!0===e?`.${t}`:`#${t}`).removeClass("hidden")},hide:function(t,e){let a=!0===(e=this.safeVar(e,!1))?`.${t}`:`#${t}`;this.idExist(t,e)&&$(a).addClass("hidden")},showModal:function(t){!0===this.idExist(t)&&$("#"+t).modal({backdrop:"static",keyboard:!1,show:!0})},hideModal:function(t){!0===this.idExist(t)&&$("#"+t).modal("hide")},idExist:function(t,e){let a=(!0===e?".":"#")+t;return!0!==this.isUndefined(t)&&$(a).length>0},isset:function(t,e){return e in t},isUndefined:function(t){return void 0===t},isArray:function(t){return $.isArray(t)},isObject:function(t){return"object"==typeof t},isBlank:function(t){return!0===this.isNull(t)||""===t},isNull:function(t){return null===t},inArray:function(t,e){return!0===this.isArray(e)&&-1!==$.inArray(t,e)},safeVar:function(t,e){try{return!1===this.isUndefined(t)?t:!1===this.isUndefined(e)?e:null}catch(t){return e}},formData:function(t,e){let a=!0===this.idExist(t)?document.getElementById(t):document.createElement("form"),s=new FormData(a);return e=this.safeVar(e,{}),!0===this.isObject(e)&&this.getLength(e,!0)>0&&$.each(e,function(t,e){s.append(t,e)}),s},getLength:function(t,e){try{if(!0===this.isObject(t)){let e=0;for(let a in t)e++;return e}return!0===this.isArray(t)?t.length:this.isBlank(t)?0:t.length}catch(t){console.log(t.message,!0)}},select_first:function(t){this.idExist(t)&&$(`#${t}`).val($(`#${t} option:first`).val())},jsonParse:function(t){try{return JSON.parse(t)}catch(t){console.error(t.message)}return{}},callHttp:function(t,e){let a=this,s=$.extend({async:!0,type:"GET",timeout:180,url:"",data:"",xhrFields:{withCredentials:!1},processData:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"},t),i=this.safeVar(t.jsondecode,!1);return $xhr=$.ajax({async:s.async,type:s.type,url:s.url,timeout:1e3*s.timeout,data:s.data,xhrFields:s.xhrFields,processData:s.processData,contentType:s.contentType,beforeSend:function(t){a.pool.push(t)},success:function(t,s,n){let r=n.getResponseHeader("content-type")||"";!1!==e&&("application/json"===r?e(!0===i?a.jsonParse(t):t):(a.toast("Unable to handle request. Please try again later"),e([])))},complete:function(t){let e=a.pool.indexOf(t);e>-1&&a.pool.splice(e,1)},statusCode:{404:function(){a.toast("Service is not available","error")},500:function(){a.toast("Unable to handle your request. Please try again later","error")},504:function(){a.toast("It's taking too much time. Unable to proceed now."),!1!==e&&e([])}},error:function(t,s,i){if("timeout"===s){let t="Unable to handle your request. Please try again later";a.toast(t,"error"),console.error(err.message),!1!==e&&e({status:"false",logout:"false",msg:t,data:{}})}}}),$xhr},abortAllHttp:function(t){let e=this;t=this.safeVar(t);try{$(e.pool).each(function(a,s){try{t&&t!==s.requestURL||(s.abort(),e.pool.splice(a,1))}catch(t){console.error(t.message)}})}catch(t){console.error(t.message)}},regex:function(t,e){let a=!1;switch(t){case"domain":a=/(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/.test(e);break;case"url":a=/((?:https?\:\/\/|www\.)(?:[-a-z0-9]+\.)*[-a-z0-9]+.*)/i.test(e);break;case"email":a=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}return a},inputSelect:function(t,e,a,s,i,n,r){if(n=this.safeVar(n,!0),i=this.isArray(i)?i:[],n?$("#"+t+" option:not(:first-child)").remove():$("#"+t+" option").remove(),this.isArray(e))try{let n="",l=this;$.each(e,function(t,e){let o=l.safeVar(e[a],"");if(""!==o){let t=l.safeVar(e[s],""),a="";!0===l.isArray(i)&&$.each(i,function(t,s){let i=$.trim(l.safeVar(e[s],"Unknown"));a+=`data-${s}="${i}" `}),n+='<option class="text-capatilize" '+a+'value="'+t+'" '+(o===r||t===r?'selected="selected"':"")+">"+o+"</option>"}}),this.sethtml(t,n,!0)}catch(t){this.debug(t.message,!0)}},validate:function(t,e,a,s,i,n,r){let l=this;if(n=!0!==this.isUndefined(n)&&n,!0===(!0===r?this.idExist(t,!0):this.idExist(t))&&(s=this.safeVar(s,[]),i=this.safeVar(i,[]),!0===this.isArray(s))){let o=!0;if(this.inArray(e,["text","select"])){let n=this.get(t);$.each(s,function(s,c){switch(c){case"blank":if(""===n)return l.toast(a+" should not be blank","error"),o=!1,!1;break;case"length":let s=l.getLength(n),u=l.safeVar(i[c],1);if(s<u)return l.toast(a+" should be "+u+" character long.","error"),o=!1,!1;break;case"maxlength":let d=l.getLength(n),h=l.safeVar(i[c],1);if(d>h)return l.toast(`Maximum ${h} ${a} are allowed.`,"error"),o=!1,!1;break;case"selected":if(""===n||null===n)return l.toast("Please select "+a+".","error"),o=!1,!1;break;case"maximum":let f=l.safeVar(i[c],0);if(n>f)return l.toast(a+" should be less than"+f+".","error"),o=!1,!1;break;case"domain":if(!1===l.regex("domain",n))return l.toast("Please provide valid "+a+".","error"),o=!1,!1;break;case"url":if(!1===l.regex("url",n))return l.toast("Please provide valid "+a+".","error"),o=!1,!1;break;case"email":if(!1===l.regex("email",n))return l.toast("Please provide valid "+a+".","error"),o=!1,!1;break;case"unique":let g=!0,p=[];if(!0===r&&"select"===e&&$("."+t).each(function(){let t=$app.safeVar($(this).val(),"");if(""!==t){if($app.inArray(t,p))return g=!1,!1;p.push(t)}}),!1===g)return l.toast("Selected all "+a+" should be unique.","error"),o=!1,!1}})}else if(this.inArray(e,["image"])){let e=document.getElementById(t);e=e.files.item(0);let r=$app.safeVar(e.name,"No File Selected"),c=$app.lowercase(r.replace(/^.*\./,""));if(!0===$app.inArray(c,["png","jpg","jpeg"])){e.type;let t=e.size;t=Math.round(t/1024);let r=new FileReader;r.onload=function(e){let r=new Image;r.src=e.target.result,r.onload=function(){let e=this.width,r=this.height;$.each(s,function(s,n){switch(n){case"minwidth":let s=l.safeVar(i[n],100);if(e<s)return l.toast(a+" width should be more than "+s+" Pixel","error"),o=!1;break;case"minheight":let c=l.safeVar(i[n],100);if(r<c)return l.toast(a+" height should be more than "+c+" Pixel","error"),o=!1;break;case"maxwidth":let u=l.safeVar(i[n],500);if(e>u)return l.toast(a+" width should be less than "+u+" Pixel","error"),o=!1;break;case"maxheight":let d=l.safeVar(i[n],500);if(r>d)return l.toast(a+" width should be less than "+d+" Pixel","error"),o=!1;break;case"maxsize":let h=l.safeVar(i[n],1);if(t>h)return l.toast(a+" size should be less than "+h+"KB","error"),o=!1}}),!1!==n&&n(o)}},r.readAsDataURL(e)}else $app.toast("Select valid image for "+a+". Example: PNG, JPG, JPEG, ","warning")}return o}return console.error("it seens to be a invalid request. Please try again later."),!1}})}),$(document).ready(function(){$.extend(Application.prototype,{admin_load_category_groups:function(t){let e=this,a=this.get_session("groups_list_next_page"),s=this.formData("blankform",{_ctid:t,_p:this.isBlank(a)?0:a});if(!1!==s){let t={url:this.base_url("rest/groups"),type:"POST",data:s,processData:!1,contentType:!1};this.callHttp(t,function(t){if("true"===t.status){let a=t.data.childs;e.set_session("groups_list_next_page",t.data.next),e.isArray(a)&&e.getLength(a)>0&&(e.addClass("groupslist","blank",!1),e.sethtml("groupslist",""),$.each(a,function(t,a){let s=1==a.status?"catenable":"catdisable";e.sethtml("groupslist",`<li id="grplist_${a.id}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center pointer ${s}" data-gid="${a.id}">\n                                <span class="ellipsis pr-4">${a.name}</span>\n                                <img class="img-fluid" src="${a.icon}" />\n                            </li>`,!0)}))}})}},admin_after_upload_category_banner:function(t){this.sethtml("catbannerurl",t.url),this.set_attr("catbannerurl","href",t.url),this.set("catbanner",t.path),$("#caticonurlimg").css("background-image",`url(${t.url})`)},admin_update_category:function(t){let e=this;!function(t){let a=!0;t=!0!==e.isUndefined(t)&&t,a=!0===(a=!0===a&&e.validate("catname","text","Name",["blank","length","maxlength"],{length:5,maxlength:60}))&&e.validate("catslug","text","Slug",["blank","length","maxlength"],{length:5,maxlength:60}),!1!==t&&t(a)}(function(a){if(a){$(t).find("i.fa").removeClass("fa-floppy-o"),$(t).find("i.fa").addClass("fa-spin fa-circle-o-notch"),$(t).find("span").text("Saving...");let a=e.formData("catrupdate");if(!1!==a){let s={url:e.base_url("rest/category/update"),type:"POST",data:a,processData:!1,contentType:!1};e.callHttp(s,function(a){$(t).find("i.fa").removeClass("fa-spin fa-circle-o-notch"),$(t).find("i.fa").addClass("fa-floppy-o"),$(t).find("span").text("Save"),"true"===a.status?(e.toast(a.data.message,"success"),function(t){e.idExist(`ctlist_${t.id}`)&&($(`#ctlist_${t.id} span`).text(t.name),e.set_attr(`ctlist_${t.id} img`,"src",t.icon),1==t.enb&&$(`#ctlist_${t.id}`).hasClass("catdisable")?($(`#ctlist_${t.id}`).removeClass("catdisable"),$(`#ctlist_${t.id}`).addClass("catenable")):0==t.enb&&$(`#ctlist_${t.id}`).hasClass("catenable")&&($(`#ctlist_${t.id}`).removeClass("catenable"),$(`#ctlist_${t.id}`).addClass("catdisable")));if(e.set_attr("textbannerurl","href",t.icon),e.set_attr("textcategoryurl","href",t.url),$("#textimgsrc").css("background-image",`url(${t.icon})`),$("#textcatname").text(t.name),$("#textcatslug").text(t.slug),0==t.pid)$("#textparentcategory").closest("div").addClass("hidden"),$("#textcategoryurl").removeClass("hidden");else{$("#textcategoryurl").addClass("hidden");let a=e.safeVar($(`#catparent option[value='${t.pid}']`).text(),"");e.isBlank(a)||($("#textparentcategory").closest("div").removeClass("hidden"),$("#textparentcategory").text(a))}let a=e.safeVar({0:"Top",1:"High",2:"Middle",3:"Low",4:"Lowest"}[t.vst],"");e.isBlank(a)?$("#textviewstate").closest("div").addClass("hidden"):($("#textviewstate").closest("div").removeClass("hidden"),$("#textviewstate").text(a));"1"==t.enb?($("#textisactive").closest("div").find("i.fa").removeClass("fa-times"),$("#textisactive").closest("div").find("i.fa").addClass("fa-check"),$("#textisactive").text("Active")):($("#textisactive").closest("div").find("i.fa").removeClass("fa-check"),$("#textisactive").closest("div").find("i.fa").addClass("fa-times"),$("#textisactive").text("Inactive"))}(a.data.category),e.hide("catrupdatesection"),e.show("catrdetailsection")):e.toast(a.msg,"error")})}}})},admin_load_subcategory:function(t){let e=this,a=this.formData("blankform",{_ctid:t});if(!1!==a){let t={url:this.base_url("rest/category"),type:"POST",data:a,processData:!1,contentType:!1};this.callHttp(t,function(t){if("true"===t.status){let a=t.data.childs,s=t.data.parent;e.isArray(a)&&e.getLength(a)>0&&(e.addClass("subctrlist","blank",!1),e.sethtml("subctrlist",""),$.each(a,function(t,a){let s=1==a.enb?"catenable":"catdisable";e.sethtml("subctrlist",`<li id="ctlist_${a.id}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center pointer ${s}" data-cid="${a.id}">\n                                <span class="ellipsis pr-4">${a.name}</span>\n                                <img class="img-fluid" src="${a.icon}" />\n                            </li>`,!0)})),function(t){if(console.log(t),e.hide("catrupdatesection"),e.show("catrdetailsection"),e.set_attr("textbannerurl","href",t.icon),e.set_attr("textcategoryurl","href",t.url),e.set_attr("textgroupsurl","href",t.gurl),$("#textimgsrc").css("background-image",`url(${t.icon})`),$("#textcatname").text(t.name),$("#textcatslug").text(t.slug),$("#textcatgroups").text(t.groups.toLocaleString("en-IN")),0==t.pid)$("#textparentcategory").closest("div").addClass("hidden"),$("#textcategoryurl").removeClass("hidden");else{$("#textcategoryurl").addClass("hidden");let a=e.safeVar($(`#catparent option[value='${t.pid}']`).text(),"");e.isBlank(a)||($("#textparentcategory").closest("div").removeClass("hidden"),$("#textparentcategory").text(a))}let a=e.safeVar({0:"Top",1:"High",2:"Middle",3:"Low",4:"Lowest"}[t.vst],"");e.isBlank(a)?$("#textviewstate").closest("div").addClass("hidden"):($("#textviewstate").closest("div").removeClass("hidden"),$("#textviewstate").text(a));"1"==t.enb?($("#textisactive").closest("div").find("i.fa").removeClass("fa-times"),$("#textisactive").closest("div").find("i.fa").addClass("fa-check"),$("#textisactive").text("Active")):($("#textisactive").closest("div").find("i.fa").removeClass("fa-check"),$("#textisactive").closest("div").find("i.fa").addClass("fa-times"),$("#textisactive").text("Inactive"))}(s),function(t){e.set("_ctrid",t.id),e.set("catname",t.name),e.set("catslug",t.slug),e.set("catbanner",t.ricon),e.sethtml("catbannerurl",t.icon),e.set_attr("catbannerurl","href",t.icon),e.set("catparent",t.pid),e.set("catviewstate",t.vst),$("#caticonurlimg").css("background-image",`url(${t.icon})`),$("#catrstatus").prop("checked","1"==t.enb)}(s)}})}},home_submitgroup:function(){let t=this;!function(e){let a=!0;e=!0!==t.isUndefined(e)&&e,a=!0===(a=!0===(a=!0===a&&t.validate("share_group_category","select","Group Category",["selected"],{}))&&t.validate("share_invite_link","text","Group Invite Link",["blank","length","maxlength","url"],{length:2,maxlength:512}))&&t.validate("group_subcategory","select","Group Sub Category",["selected"],{}),!1!==e&&e(a)}(function(e){if(e){let e=t.formData("blankform",{_cid:t.getSelected("share_group_category"),_lnk:t.get("share_invite_link"),_sid:t.getSelected("group_subcategory")});if(!1!==e){let a={url:t.base_url("api/group"),type:"POST",data:e,processData:!1,contentType:!1};t.callHttp(a,function(e){"true"===e.status&&(t.select_first("share_group_category"),t.set("share_invite_link"),t.hideModal("group_submit"),t.select_first("group_subcategory"))})}}})},home_sharegroup:function(){let t=this,e=this.getSelected("share_group_category",!0),a=this.getSelected("share_group_category");!function(e){let a=!0;e=!0!==t.isUndefined(e)&&e,a=!0===(a=!0===a&&t.validate("share_group_category","select","Group Category",["selected"],{}))&&t.validate("share_invite_link","text","Group Invite Link",["blank","length","maxlength","url"],{length:2,maxlength:512}),!1!==e&&e(a)}(function(s){if(s){let s=t.formData("blankform",{_ctid:a});if(!1!==s){let a={url:t.base_url("api/subcat"),type:"POST",data:s,processData:!1,contentType:!1};t.callHttp(a,function(a){"true"===a.status&&(t.sethtml("group_category_name",e),t.inputSelect("group_subcategory",a.data,"name","id"),t.showModal("group_submit"))})}}})},select_category:function(t){let e=this,a=t.val(),s=t.data("subcategory"),i=this.formData("blankform",{_ctid:a});if(!1!==i){let t={url:this.base_url("api/subcat"),type:"POST",data:i,processData:!1,contentType:!1};this.callHttp(t,function(t){"true"===t.status&&e.inputSelect(s,t.data,"name","id")})}},upload_file_to_cloud:function(t){let e=this;var a=this.formData("blank",{file:$(t).prop("files")[0]});if(!1!==a){let s={url:this.base_url("rest/cloud"),type:"POST",data:a,processData:!1,contentType:!1};this.callHttp(s,function(a){if("true"===a.status){e.toast(a.data.message,"success");try{let s=e.safeVar($(t).data("callback"),"");if(!e.isBlank(s)){let t=e[s];"function"==typeof t?t.call(e,a.data):console.error(`${s} is not a function`)}}catch(t){console.error(t.message)}}else e.toast(a.data,"error")})}}})}),$(document).ready(function(){let t=new Application;t.init(),$("body").on("change",".imguploads",function(){if($(this).get(0).files.length>0)try{let e=t.safeVar($(this).data("callback"),"");if(!t.isBlank(e)){let a=t[e];"function"==typeof a?a.call(t,{url:"",path:""}):console.error(`${e} is not a function`)}t.upload_file_to_cloud(this)}catch(t){console.error(t.message)}}),$("body").on("click",".ldgrplist li",function(){let e=$(this).data("cid"),a=$.trim($(this).text()),s=$(this).closest("div.collist-container").find("input.form-control").attr("id");t.set(s,a),"search_category"==s&&(t.set("search_groups",""),t.sethtml("groupslist",""),t.addClass("groupslist","blank")),t.admin_load_category_groups(e)}),$("body").on("click","#ctr_upd_btn",function(){t.admin_update_category(this)}),$("body").on("click",".ldcatlist li",function(){let e=$(this).data("cid"),a=$.trim($(this).text()),s=$(this).closest("div.collist-container").find("input.form-control").attr("id");t.set(s,a),console.log(s),"search_category"==s&&(t.set("search_subctr",""),t.sethtml("subctrlist",""),t.addClass("subctrlist","blank")),t.admin_load_subcategory(e)}),$("body").on("click","#share_group_btn",function(){t.home_sharegroup()}),$("body").on("click","#submit_group_btn",function(){t.home_submitgroup()}),$("body").on("click","#editcatr",function(){t.hide("catrdetailsection"),t.show("catrupdatesection")}),$("body").on("change","#group_category_target",function(){t.select_category($(this))}),$(window).bind("beforeunload",function(){t.abortAllHttp()}),$("body").on("input keydown keyup mousedown mouseup select contextmenu drop",".adtext",function(t){switch($value=$(this).val(),$format=void 0!==$(this).data("format")?$(this).data("format"):"anum",$length=void 0!==$(this).data("length")?$(this).data("length"):9999,$maximum=void 0!==$(this).data("max")?$(this).data("max"):9999,$filter=!1,$format){case"numr":$tmp=""!==$value?$value:0,$filter=/^[0-9]+$/i.test($tmp)&&$tmp<=$maximum;break;case"alph":$filter=/^[a-zA-Z]+$/i.test($value)&&$value.length<=$length||""===$value;break;case"scalp":$filter=/^[a-z]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anum":$filter=/^[a-z0-9]+$/i.test($value)&&$value.length<=$length||""===$value;break;case"anumd":$filter=/^[A-Za-z0-9.]+$/i.test($value)&&$value.length<=$length||""===$value;break;case"anspc":$filter=/^[a-z0-9 ]+$/i.test($value)&&$value.length<=$length||""===$value;break;case"anundr":$filter=/^(?!.*__.*)[A-Za-z0-9_]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anundrdt":$filter=/^(?!.*__.*)[A-Za-z0-9_.]+$/.test($value)&&$value.length<=$length||""===$value;break;case"ansundr":$filter=/^(?!.*__.*)(?!.*  .*)[A-Za-z0-9_ ]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anundh":$filter=/^(?!.*__.*)(?!.*--.*)[A-Za-z0-9_-]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anudh":$filter=/^(?!.*__.*)(?!.*--.*)[A-Za-z0-9_.-]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anwdh":$filter=/^(?!.*--.*)[A-Za-z0-9-]+$/.test($value)&&$value.length<=$length||""===$value;break;case"ansdh":$filter=/^(?!.*--.*)[A-Za-z0-9./]+$/.test($value)&&$value.length<=$length||""===$value;break;case"anatdh":$filter=/^(?!.*--.*)[A-Za-z0-9.@]+$/.test($value)&&$value.length<=$length||""===$value;break;default:$filter=$value.length<=$length}if($filter)return $(this).data("old",$value),!0;{let t=$app.safeVar($(this).data("old"),"");return $(this).val(t),!1}})});